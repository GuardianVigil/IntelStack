{% extends 'components/layouts/default.html' %}
{% load static %}

{% block content %}

<script src="{% static 'assets/js/simple-datatables.js' %}"></script>


<div class="container mx-auto p-6" x-data="ipAnalysis">
    <h1 class="text-2xl font-bold mb-6 text-center">IP Threat Intelligence Analysis</h1>

    <!-- Search Bar -->
    <div class="mb-8">
        <form @submit.prevent="analyzeIP" class="max-w-3xl mx-auto">
            <div class="flex gap-4">
                <input 
                    type="text" 
                    placeholder="Enter IP address (e.g., 8.8.8.8)" 
                    class="form-input flex-1 py-2 px-4 border rounded-lg"
                    x-model="ipAddress"
                    :disabled="isLoading"
                    required
                />
                <button 
                    type="submit" 
                    class="btn btn-primary px-8 py-2 rounded-lg bg-black text-white hover:bg-gray-800 disabled:opacity-50"
                    :disabled="isLoading"
                >
                    <span x-show="!isLoading">Analyze</span>
                    <div x-show="isLoading" class="flex items-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Analyzing...</span>
                    </div>
                </button>
            </div>
        </form>
    </div>

    <!-- Error Message -->
    <div x-show="error" x-cloak class="mb-8">
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
            <strong class="font-bold">Error!</strong>
            <span class="block sm:inline" x-text="error"></span>
        </div>
    </div>

    <!-- Results Section -->

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="panel h-full">
            <div class="flex items-center mb-5">
                <h5 class="font-semibold text-lg dark:text-white-light">Threat Scores</h5>
            </div>
            <div class="overflow-hidden">
                <div x-ref="threatScoreChart" class="bg-white dark:bg-black rounded-lg">
                    <!-- loader -->
                    <div class="min-h-[353px] grid place-content-center bg-white-light/30 dark:bg-dark dark:bg-opacity-[0.08] ">
                        <span class="animate-spin border-2 border-black dark:border-white !border-l-transparent  rounded-full w-5 h-5 inline-flex"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel h-full">
            <div class="flex items-start justify-between mb-5">
                <h5 class="font-semibold text-lg dark:text-white-light">Platform Score</h5>
            </div>
            <div class="flex flex-col space-y-5">
                <div class="flex items-center">
                    <div class="w-9 h-9">
                        <div class="bg-primary/10 text-primary rounded-xl w-9 h-9 flex justify-center items-center dark:bg-primary dark:text-white-light">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                                <circle cx="12" cy="12" r="10"></circle>
                                <circle opacity="0.5" cx="12" cy="12" r="4"></circle>
                                <line opacity="0.5" x1="21.17" y1="8" x2="12" y2="8"></line>
                                <line opacity="0.5" x1="3.95" y1="6.06" x2="8.54" y2="14"></line>
                                <line opacity="0.5" x1="10.88" y1="21.94" x2="15.46" y2="14"></line>
                            </svg>
                        </div>
                    </div>
                    <div class="px-3 flex-initial w-full">
                        <div class="w-summary-info flex justify-between font-semibold text-white-dark mb-1">
                            <h6>VirusTotal</h6>
                            <p class="ltr:ml-auto rtl:mr-auto text-xs">65%</p>
                        </div>
                        <div>
                            <div class="w-full rounded-full h-5 p-1 bg-dark-light overflow-hidden shadow-3xl dark:bg-dark-light/10 dark:shadow-none">
                                <div class="bg-gradient-to-r from-[#009ffd] to-[#2a2a72] w-full h-full rounded-full relative before:absolute before:inset-y-0 ltr:before:right-0.5 rtl:before:left-0.5 before:bg-white before:w-2 before:h-2 before:rounded-full before:m-auto" style="width: 65%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-9 h-9">
                        <div class="bg-danger/10 text-danger rounded-xl w-9 h-9 flex justify-center items-center dark:bg-danger dark:text-white-light">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                                <circle opacity="0.5" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" />
                                <path d="M13.024 14.5601C10.7142 15.484 9.5593 15.946 8.89964 15.4977C8.74324 15.3914 8.60834 15.2565 8.50206 15.1001C8.0538 14.4405 8.51575 13.2856 9.43967 10.9758C9.63673 10.4831 9.73527 10.2368 9.90474 10.0435C9.94792 9.99429 9.99429 9.94792 10.0435 9.90474C10.2368 9.73527 10.4831 9.63673 10.9758 9.43966C13.2856 8.51575 14.4405 8.0538 15.1001 8.50206C15.2565 8.60834 15.3914 8.74324 15.4977 8.89964C15.946 9.5593 15.484 10.7142 14.5601 13.024C14.363 13.5166 14.2645 13.763 14.095 13.9562C14.0518 14.0055 14.0055 14.0518 13.9562 14.095C13.763 14.2645 13.5166 14.363 13.024 14.5601Z" stroke="currentColor" stroke-width="1.5" />
                            </svg>
                        </div>
                    </div>
                    <div class="px-3 flex-initial w-full">
                        <div class="w-summary-info flex justify-between font-semibold text-white-dark mb-1">
                            <h6>AbuseIPDB</h6>
                            <p class="ltr:ml-auto rtl:mr-auto text-xs">40%</p>
                        </div>
                        <div>
                            <div class="w-full rounded-full h-5 p-1 bg-dark-light overflow-hidden shadow-3xl dark:bg-dark-light/10 dark:shadow-none">
                                <div class="bg-gradient-to-r from-[#a71d31] to-[#3f0d12] w-full h-full rounded-full relative before:absolute before:inset-y-0 ltr:before:right-0.5 rtl:before:left-0.5 before:bg-white before:w-2 before:h-2 before:rounded-full before:m-auto" style="width: 40%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="w-9 h-9">
                        <div class="bg-warning/10 text-warning rounded-xl w-9 h-9 flex justify-center items-center dark:bg-warning dark:text-white-light">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                                <path opacity="0.5" d="M2 12H22M16 12C16 13.3132 15.8965 14.6136 15.6955 15.8268C15.4945 17.0401 15.1999 18.1425 14.8284 19.0711C14.457 19.9997 14.016 20.7362 13.5307 21.2388C13.0454 21.7413 12.5253 22 12 22C11.4747 22 10.9546 21.7413 10.4693 21.2388C9.98396 20.7362 9.54301 19.9997 9.17157 19.0711C8.80014 18.1425 8.5055 17.0401 8.30448 15.8268C8.10346 14.6136 8 13.3132 8 12C8 10.6868 8.10346 9.38642 8.30448 8.17316C8.5055 6.95991 8.80014 5.85752 9.17157 4.92893C9.54301 4.00035 9.98396 3.26375 10.4693 2.7612C10.9546 2.25866 11.4747 2 12 2C12.5253 2 13.0454 2.25866 13.5307 2.76121C14.016 3.26375 14.457 4.00035 14.8284 4.92893C15.1999 5.85752 15.4945 6.95991 15.6955 8.17317C15.8965 9.38642 16 10.6868 16 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M22 12C22 13.3132 21.7413 14.6136 21.2388 15.8268C20.7362 17.0401 19.9997 18.1425 19.0711 19.0711C18.1425 19.9997 17.0401 20.7362 15.8268 21.2388C14.6136 21.7413 13.3132 22 12 22C10.6868 22 9.38642 21.7413 8.17317 21.2388C6.95991 20.7362 5.85752 19.9997 4.92893 19.0711C4.00035 18.1425 3.26375 17.0401 2.7612 15.8268C2.25866 14.6136 2 13.3132 2 12C2 10.6868 2.25866 9.38642 2.76121 8.17316C3.26375 6.95991 4.00035 5.85752 4.92893 4.92893C5.85752 4.00035 6.95991 3.26375 8.17317 2.7612C9.38642 2.25866 10.6868 2 12 2C13.3132 2 14.6136 2.25866 15.8268 2.76121C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12L22 12Z" stroke="currentColor" stroke-width="1.5" />
                        </svg>
                    </div>
                </div>
                <div class="px-3 flex-initial w-full">
                    <div class="w-summary-info flex justify-between font-semibold text-white-dark mb-1">
                        <h6>CrowdSec</h6>
                        <p class="ltr:ml-auto rtl:mr-auto text-xs">25%</p>
                    </div>
                    <div>
                        <div class="w-full rounded-full h-5 p-1 bg-dark-light overflow-hidden shadow-3xl dark:bg-dark-light/10 dark:shadow-none">
                            <div class="bg-gradient-to-r from-[#fe5f75] to-[#fc9842] w-full h-full rounded-full relative before:absolute before:inset-y-0 ltr:before:right-0.5 rtl:before:left-0.5 before:bg-white before:w-2 before:h-2 before:rounded-full before:m-auto" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-9 h-9">
                    <div class="bg-warning/10 text-warning rounded-xl w-9 h-9 flex justify-center items-center dark:bg-warning dark:text-white-light">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                            <path opacity="0.5" d="M2 12H22M16 12C16 13.3132 15.8965 14.6136 15.6955 15.8268C15.4945 17.0401 15.1999 18.1425 14.8284 19.0711C14.457 19.9997 14.016 20.7362 13.5307 21.2388C13.0454 21.7413 12.5253 22 12 22C11.4747 22 10.9546 21.7413 10.4693 21.2388C9.98396 20.7362 9.54301 19.9997 9.17157 19.0711C8.80014 18.1425 8.5055 17.0401 8.30448 15.8268C8.10346 14.6136 8 13.3132 8 12C8 10.6868 8.10346 9.38642 8.30448 8.17316C8.5055 6.95991 8.80014 5.85752 9.17157 4.92893C9.54301 4.00035 9.98396 3.26375 10.4693 2.7612C10.9546 2.25866 11.4747 2 12 2C12.5253 2 13.0454 2.25866 13.5307 2.76121C14.016 3.26375 14.457 4.00035 14.8284 4.92893C15.1999 5.85752 15.4945 6.95991 15.6955 8.17317C15.8965 9.38642 16 10.6868 16 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M22 12C22 13.3132 21.7413 14.6136 21.2388 15.8268C20.7362 17.0401 19.9997 18.1425 19.0711 19.0711C18.1425 19.9997 17.0401 20.7362 15.8268 21.2388C14.6136 21.7413 13.3132 22 12 22C10.6868 22 9.38642 21.7413 8.17317 21.2388C6.95991 20.7362 5.85752 19.9997 4.92893 19.0711C4.00035 18.1425 3.26375 17.0401 2.7612 15.8268C2.25866 14.6136 2 13.3132 2 12C2 10.6868 2.25866 9.38642 2.76121 8.17316C3.26375 6.95991 4.00035 5.85752 4.92893 4.92893C5.85752 4.00035 6.95991 3.26375 8.17317 2.7612C9.38642 2.25866 10.6868 2 12 2C13.3132 2 14.6136 2.25866 15.8268 2.76121C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12L22 12Z" stroke="currentColor" stroke-width="1.5" />
                        </svg>
                    </div>
                </div>
                <div class="px-3 flex-initial w-full">
                    <div class="w-summary-info flex justify-between font-semibold text-white-dark mb-1">
                        <h6>GreyNoise</h6>
                        <p class="ltr:ml-auto rtl:mr-auto text-xs">25%</p>
                    </div>
                    <div>
                        <div class="w-full rounded-full h-5 p-1 bg-dark-light overflow-hidden shadow-3xl dark:bg-dark-light/10 dark:shadow-none">
                            <div class="bg-gradient-to-r from-[#fe5f75] to-[#fc9842] w-full h-full rounded-full relative before:absolute before:inset-y-0 ltr:before:right-0.5 rtl:before:left-0.5 before:bg-white before:w-2 before:h-2 before:rounded-full before:m-auto" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex items-center">
                <div class="w-9 h-9">
                    <div class="bg-warning/10 text-warning rounded-xl w-9 h-9 flex justify-center items-center dark:bg-warning dark:text-white-light">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
                            <path opacity="0.5" d="M2 12H22M16 12C16 13.3132 15.8965 14.6136 15.6955 15.8268C15.4945 17.0401 15.1999 18.1425 14.8284 19.0711C14.457 19.9997 14.016 20.7362 13.5307 21.2388C13.0454 21.7413 12.5253 22 12 22C11.4747 22 10.9546 21.7413 10.4693 21.2388C9.98396 20.7362 9.54301 19.9997 9.17157 19.0711C8.80014 18.1425 8.5055 17.0401 8.30448 15.8268C8.10346 14.6136 8 13.3132 8 12C8 10.6868 8.10346 9.38642 8.30448 8.17316C8.5055 6.95991 8.80014 5.85752 9.17157 4.92893C9.54301 4.00035 9.98396 3.26375 10.4693 2.7612C10.9546 2.25866 11.4747 2 12 2C12.5253 2 13.0454 2.25866 13.5307 2.76121C14.016 3.26375 14.457 4.00035 14.8284 4.92893C15.1999 5.85752 15.4945 6.95991 15.6955 8.17317C15.8965 9.38642 16 10.6868 16 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M22 12C22 13.3132 21.7413 14.6136 21.2388 15.8268C20.7362 17.0401 19.9997 18.1425 19.0711 19.0711C18.1425 19.9997 17.0401 20.7362 15.8268 21.2388C14.6136 21.7413 13.3132 22 12 22C10.6868 22 9.38642 21.7413 8.17317 21.2388C6.95991 20.7362 5.85752 19.9997 4.92893 19.0711C4.00035 18.1425 3.26375 17.0401 2.7612 15.8268C2.25866 14.6136 2 13.3132 2 12C2 10.6868 2.25866 9.38642 2.76121 8.17316C3.26375 6.95991 4.00035 5.85752 4.92893 4.92893C5.85752 4.00035 6.95991 3.26375 8.17317 2.7612C9.38642 2.25866 10.6868 2 12 2C13.3132 2 14.6136 2.25866 15.8268 2.76121C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12L22 12Z" stroke="currentColor" stroke-width="1.5" />
                        </svg>
                    </div>
                </div>
                <div class="px-3 flex-initial w-full">
                    <div class="w-summary-info flex justify-between font-semibold text-white-dark mb-1">
                        <h6>SecurityTrails</h6>
                        <p class="ltr:ml-auto rtl:mr-auto text-xs">25%</p>
                    </div>
                    <div>
                        <div class="w-full rounded-full h-5 p-1 bg-dark-light overflow-hidden shadow-3xl dark:bg-dark-light/10 dark:shadow-none">
                            <div class="bg-gradient-to-r from-[#fe5f75] to-[#fc9842] w-full h-full rounded-full relative before:absolute before:inset-y-0 ltr:before:right-0.5 rtl:before:left-0.5 before:bg-white before:w-2 before:h-2 before:rounded-full before:m-auto" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel h-full">
        <div class="flex items-center justify-between mb-5">
            <h5 class="font-semibold text-lg dark:text-white-light">WHOIS Lookup</h5>
        </div>
        <div class="mb-5">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Info</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ISP:</td>
                            <td>{{ data.isp }}</td>
                        </tr>
                        <tr>
                            <td>Usage Type:</td>
                            <td>{{ data.usage_type }}</td>
                        </tr>
                        <tr>
                            <td>ASN:</td>
                            <td>{{ data.asn }}</td>
                        </tr>
                        <tr>
                            <td>Domain:</td>
                            <td>{{ data.domain }}</td>
                        </tr>

                        <tr>
                            <td>Country</td>
                            <td>{{ data.country }}</td>
                        </tr>
                        <tr>
                            <td>City</td>
                            <td>{{ data.city }}</td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>

    <!-- Platforms API response in table -->
    <div class="panel">
        <div class="mb-5" x-data="{ tab: 'home' }">
            <div>
                <ul class="flex flex-wrap mt-3 mb-5 border-b border-white-light dark:border-[#191e3a]">
                    <li>
                        <a href="javascript:;" class="p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 before:absolute hover:text-secondary before:bottom-0 before:w-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full" :class="{ 'before:!w-full text-secondary': tab === 'home' }" @click="tab='home'">

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 ltr:mr-2 rtl:ml-2">
                                <path opacity="0.5" d="M2 12H22M16 12C16 13.3132 15.8965 14.6136 15.6955 15.8268C15.4945 17.0401 15.1999 18.1425 14.8284 19.0711C14.457 19.9997 14.016 20.7362 13.5307 21.2388C13.0454 21.7413 12.5253 22 12 22C11.4747 22 10.9546 21.7413 10.4693 21.2388C9.98396 20.7362 9.54301 19.9997 9.17157 19.0711C8.80014 18.1425 8.5055 17.0401 8.30448 15.8268C8.10346 14.6136 8 13.3132 8 12C8 10.6868 8.10346 9.38642 8.30448 8.17316C8.5055 6.95991 8.80014 5.85752 9.17157 4.92893C9.54301 4.00035 9.98396 3.26375 10.4693 2.7612C10.9546 2.25866 11.4747 2 12 2C12.5253 2 13.0454 2.25866 13.5307 2.76121C14.016 3.26375 14.457 4.00035 14.8284 4.92893C15.1999 5.85752 15.4945 6.95991 15.6955 8.17317C15.8965 9.38642 16 10.6868 16 12Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                                <path d="M22 12C22 13.3132 21.7413 14.6136 21.2388 15.8268C20.7362 17.0401 19.9997 18.1425 19.0711 19.0711C18.1425 19.9997 17.0401 20.7362 15.8268 21.2388C14.6136 21.7413 13.3132 22 12 22C10.6868 22 9.38642 21.7413 8.17317 21.2388C6.95991 20.7362 5.85752 19.9997 4.92893 19.0711C4.00035 18.1425 3.26375 17.0401 2.7612 15.8268C2.25866 14.6136 2 13.3132 2 12C2 10.6868 2.25866 9.38642 2.76121 8.17316C3.26375 6.95991 4.00035 5.85752 4.92893 4.92893C5.85752 4.00035 6.95991 3.26375 8.17317 2.7612C9.38642 2.25866 10.6868 2 12 2C13.3132 2 14.6136 2.25866 15.8268 2.76121C17.0401 3.26375 18.1425 4.00035 19.0711 4.92893C19.9997 5.85752 20.7362 6.95991 21.2388 8.17317C21.7413 9.38642 22 10.6868 22 12L22 12Z" stroke="currentColor" stroke-width="1.5" />
                        </svg>

                        VirusTotal</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full" :class="{ 'before:!w-full text-secondary': tab === 'profile' }" @click="tab='profile'">

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 ltr:mr-2 rtl:ml-2">
                                <circle cx="12" cy="6" r="4" stroke="currentColor" stroke-width="1.5" />
                                <ellipse opacity="0.5" cx="12" cy="17" rx="7" ry="4" stroke="currentColor" stroke-width="1.5" />
                            </svg>

                            AbuseIPDB</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full" :class="{ 'before:!w-full text-secondary': tab === 'contact' }" @click="tab='contact'">

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 ltr:mr-2 rtl:ml-2">
                                <path d="M16.1007 13.359L16.5562 12.9062C17.1858 12.2801 18.1672 12.1515 18.9728 12.5894L20.8833 13.628C22.1102 14.2949 22.3806 15.9295 21.4217 16.883L20.0011 18.2954C19.6399 18.6546 19.1917 18.9171 18.6763 18.9651M4.00289 5.74561C3.96765 5.12559 4.25823 4.56668 4.69185 4.13552L6.26145 2.57483C7.13596 1.70529 8.61028 1.83992 9.37326 2.85908L10.6342 4.54348C11.2507 5.36691 11.1841 6.49484 10.4775 7.19738L10.1907 7.48257" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M18.6763 18.9651C17.0469 19.117 13.0622 18.9492 8.8154 14.7266C4.81076 10.7447 4.09308 7.33182 4.00293 5.74561" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M16.1007 13.3589C16.1007 13.3589 15.0181 14.4353 12.0631 11.4971C9.10807 8.55886 10.1907 7.48242 10.1907 7.48242" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>

                            CrowdSec</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full" :class="{ 'before:!w-full text-secondary': tab === 'contact' }" @click="tab='contact'">

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 ltr:mr-2 rtl:ml-2">
                                <path d="M16.1007 13.359L16.5562 12.9062C17.1858 12.2801 18.1672 12.1515 18.9728 12.5894L20.8833 13.628C22.1102 14.2949 22.3806 15.9295 21.4217 16.883L20.0011 18.2954C19.6399 18.6546 19.1917 18.9171 18.6763 18.9651M4.00289 5.74561C3.96765 5.12559 4.25823 4.56668 4.69185 4.13552L6.26145 2.57483C7.13596 1.70529 8.61028 1.83992 9.37326 2.85908L10.6342 4.54348C11.2507 5.36691 11.1841 6.49484 10.4775 7.19738L10.1907 7.48257" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M18.6763 18.9651C17.0469 19.117 13.0622 18.9492 8.8154 14.7266C4.81076 10.7447 4.09308 7.33182 4.00293 5.74561" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M16.1007 13.3589C16.1007 13.3589 15.0181 14.4353 12.0631 11.4971C9.10807 8.55886 10.1907 7.48242 10.1907 7.48242" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>

                            GreyNoise</a>
                    </li>
                    <li>
                        <a href="javascript:;" class="p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full" :class="{ 'before:!w-full text-secondary': tab === 'contact' }" @click="tab='contact'">

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 ltr:mr-2 rtl:ml-2">
                                <path d="M16.1007 13.359L16.5562 12.9062C17.1858 12.2801 18.1672 12.1515 18.9728 12.5894L20.8833 13.628C22.1102 14.2949 22.3806 15.9295 21.4217 16.883L20.0011 18.2954C19.6399 18.6546 19.1917 18.9171 18.6763 18.9651M4.00289 5.74561C3.96765 5.12559 4.25823 4.56668 4.69185 4.13552L6.26145 2.57483C7.13596 1.70529 8.61028 1.83992 9.37326 2.85908L10.6342 4.54348C11.2507 5.36691 11.1841 6.49484 10.4775 7.19738L10.1907 7.48257" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M18.6763 18.9651C17.0469 19.117 13.0622 18.9492 8.8154 14.7266C4.81076 10.7447 4.09308 7.33182 4.00293 5.74561" stroke="currentColor" stroke-width="1.5" />
                                <path opacity="0.5" d="M16.1007 13.3589C16.1007 13.3589 15.0181 14.4353 12.0631 11.4971C9.10807 8.55886 10.1907 7.48242 10.1907 7.48242" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>

                            SecurityTrails</a>
                    </li>

                </ul>
            </div>
            <div class="flex-1 text-sm ">
                <template x-if="tab === 'home'">
                    <div x-data="tableData">
                        <div class="panel mt-6">
                            <table id="tableHover"></table>
                        </div>
                    </div>
                </template>
                <template x-if="tab === 'profile'">
                    <div>
                        <div class="flex items-start">
                            <div class="w-20 h-20 ltr:mr-4 rtl:ml-4 flex-none">
                                <img src="{% static 'assets/images/profile-34.jpeg' %}" alt="image" class="w-20 h-20 m-0 rounded-full ring-2 ring-[#ebedf2] dark:ring-white-dark object-cover /">
                            </div>
                            <div class="flex-auto">
                                <h5 class="text-xl font-medium mb-4">Media heading</h5>
                                <p class="text-white-dark">Cras sit amet nibh libero, in gravida nulla.
                                    Nulla vel metus scelerisque ante sollicitudin. Cras purus odio,
                                    vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum
                                    nunc ac nisi vulputate fringilla. Donec lacinia congue felis in
                                    faucibus.</p>
                            </div>
                        </div>
                    </div>
                </template>
                <template x-if="tab === 'contact'">
                    <div>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                            nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                            Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                            fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                            culpa qui officia deserunt mollit anim id est laborum.</p>
                    </div>
                </template>
            </div>
        </div>
        <template x-if="codeArr.includes('code9')">
            <pre class="code overflow-auto !bg-[#191e3a] p-4 rounded-md text-white">
&lt;!-- animated line --&gt;
&lt;div class=&quot;mb-5&quot; x-data=&quot;{ tab: 'home'}&quot;&gt;
&lt;!-- buttons --&gt;
&lt;div&gt;
    &lt;ul class=&quot;flex flex-wrap mt-3 mb-5 border-b border-white-light dark:border-[#191e3a]&quot;&gt;
        &lt;li&gt;
            &lt;a href=&quot;javascript:&quot; class=&quot;p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 before:absolute hover:text-secondary before:bottom-0 before:w-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full&quot; :class=&quot;{'before:w-full text-secondary' : tab === 'home'}&quot; @click=&quot;tab='home'&quot;&gt;
                &lt;svg&gt; ... &lt;/svg&gt;Home&lt;/a&gt;
        &lt;/li&gt;
        &lt;li&gt;
            &lt;a href=&quot;javascript:&quot; class=&quot;p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full&quot; :class=&quot;{'before:w-full text-secondary' : tab === 'profile'}&quot; @click=&quot;tab='profile'&quot;&gt;
                &lt;svg&gt; ... &lt;/svg&gt;Profile&lt;/a&gt;
        &lt;/li&gt;
        &lt;li&gt;
            &lt;a href=&quot;javascript:&quot; class=&quot;p-5 py-3 -mb-[1px] flex items-center relative before:transition-all before:duration-700 hover:text-secondary before:absolute before:w-0 before:bottom-0 before:left-0 before:right-0 before:m-auto before:h-[1px] before:bg-secondary hover:before:w-full&quot; :class=&quot;{'before:w-full text-secondary' : tab === 'contact'}&quot; @click=&quot;tab='contact'&quot;&gt;
                &lt;svg&gt; ... &lt;/svg&gt;Contact&lt;/a&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;

&lt;!-- description --&gt;
&lt;div class=&quot;flex-1 text-sm &quot;&gt;
    &lt;template x-if=&quot;tab === 'home'&quot;&gt;
        &lt;div&gt;
            &lt;h4 class=&quot;font-semibold text-2xl mb-4&quot;&gt;We move your world!&lt;/h4&gt;
            &lt;p class=&quot;mb-4&quot;&gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. &lt;/p&gt;
            &lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. &lt;/p&gt;
        &lt;/div&gt;
    &lt;/template&gt;
    &lt;template x-if=&quot;tab === 'profile'&quot;&gt;
        &lt;div&gt;
            &lt;div class=&quot;flex items-start&quot;&gt;
                &lt;div class=&quot;w-20 h-20 ltr:mr-4 rtl:ml-4 flex-none&quot;&gt;
                    &lt;img src=&quot;&#123;&#37; static 'assets/images/profile-34.jpeg' &#37;&#125;&quot; alt=&quot;image&quot; class=&quot;w-20 h-20 m-0 rounded-full ring-2 ring-[#ebedf2] dark:ring-white-dark object-cover&quot; /&gt;
                &lt;/div&gt;
                &lt;div class=&quot;flex-auto&quot;&gt;
                    &lt;h5 class=&quot;text-xl font-medium mb-4&quot;&gt;Media heading&lt;/h5&gt;
                    &lt;p class=&quot;text-white-dark&quot;&gt;Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/template&gt;
    &lt;template x-if=&quot;tab === 'contact'&quot;&gt;
        &lt;div&gt;
            &lt;p&gt;Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&lt;/p&gt;
        &lt;/div&gt;
    &lt;/template&gt;
&lt;/div&gt;
&lt;/div&gt;
</pre>
        </template>
    </div>

    <!-- Results Section end -->
    <div x-show="results" class="space-y-6">
        <!-- Threat Score and Platform Scores -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Threat Score Chart -->
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-lg font-semibold mb-2">Overall Threat Score</h2>
                <div class="relative w-40 h-40 mx-auto">
                    <canvas id="threatScoreChart"></canvas>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-2xl font-bold" x-text="results.overall_score"></span>
                    </div>
                </div>
            </div>

            <!-- Platform Scores -->
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-lg font-semibold mb-2">Platform Scores</h2>
                <div class="space-y-2">
                    <template x-for="(platform, index) in ['virustotal', 'abuseipdb', 'crowdsec', 'greynoise', 'securitytrails']">
                        <div class="flex justify-between items-center py-1">
                            <span class="text-gray-600" x-text="platform.charAt(0).toUpperCase() + platform.slice(1) + ':'"></span>
                            <span x-text="results[platform] || 'N/A'" :class="{
                                'text-green-500': results[platform] <= 3,
                                'text-yellow-500': results[platform] > 3 && results[platform] <= 7,
                                'text-red-500': results[platform] > 7
                            }"></span>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Platform Details -->
        <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
            <div class="flex flex-wrap gap-2 mb-4">
                <template x-for="platform in ['virustotal', 'abuseipdb', 'crowdsec', 'greynoise', 'securitytrails']">
                    <button 
                        class="px-3 py-1.5 rounded-lg transition-all duration-300 text-sm"
                        :class="{'bg-black text-white': activeTab === platform, 'bg-gray-100': activeTab !== platform}"
                        @click="activeTab = platform"
                        x-text="platform.charAt(0).toUpperCase() + platform.slice(1)"
                    ></button>
                </template>
            </div>

            <!-- Tab Content -->
            <template x-for="platform in ['virustotal', 'abuseipdb', 'crowdsec', 'greynoise', 'securitytrails']">
                <div x-show="activeTab === platform" class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-3 py-2 text-left text-sm font-medium text-gray-600">Field</th>
                                <th class="px-3 py-2 text-left text-sm font-medium text-gray-600">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-if="results[platform + '_data']">
                                <template x-for="(value, key) in results[platform + '_data']">
                                    <tr class="border-t">
                                        <td class="px-3 py-2 text-sm font-medium" x-text="key"></td>
                                        <td class="px-3 py-2 text-sm" x-text="typeof value === 'object' ? JSON.stringify(value) : value"></td>
                                    </tr>
                                </template>
                            </template>
                            <template x-if="!results[platform + '_data']">
                                <tr>
                                    <td colspan="2" class="px-3 py-2 text-center text-gray-500 text-sm">No data available</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </template>
        </div>
    </div>

    <!-- Alpine.js Script -->
    <script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('ipAnalysis', () => ({
            ipAddress: '',
            results: null,
            error: null,
            isLoading: false,
            activeTab: 'virustotal',
            activeTabData: {},
            chart: null,

            async analyzeIP() {
                this.isLoading = true;
                this.error = null;
                this.results = null;
                
                if (this.chart) {
                    this.chart.destroy();
                    this.chart = null;
                }

                try {
                    const response = await fetch(`/api/analyze-ip/${this.ipAddress}/`);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to analyze IP address');
                    }
                    
                    this.results = await response.json();
                    this.activeTab = 'virustotal';
                    this.$nextTick(() => this.initializeCharts());
                } catch (error) {
                    console.error('Error analyzing IP:', error);
                    this.error = error.message || 'An error occurred while analyzing the IP address';
                } finally {
                    this.isLoading = false;
                }
            },

            initializeCharts() {
                const ctx = document.getElementById('threatScoreChart');
                if (!ctx || !this.results) return;

                const score = this.results.overall_score;
                const color = score <= 3 ? '#22c55e' : score <= 7 ? '#eab308' : '#ef4444';

                const data = {
                    labels: ['Threat Score'],
                    datasets: [{
                        data: [score, 10 - score],
                        backgroundColor: [color, '#e5e7eb'],
                        borderWidth: 0
                    }]
                };

                const config = {
                    type: 'doughnut',
                    data: data,
                    options: {
                        responsive: true,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: false
                            }
                        }
                    }
                };

                if (this.chart) {
                    this.chart.destroy();
                }

                this.chart = new Chart(ctx, config);
            },

            init() {
                this.$watch('results', () => {
                    if (this.results) {
                        this.$nextTick(() => this.initializeCharts());
                    }
                });
            }
        }));
    });



    document.addEventListener("alpine:init", () => {
        Alpine.data("tableData", () => ({
            init() {
                const tableOptions = {
                    data: {
                        headings: ["ID", "First Name", "Last Name", "Email", "Phone"],
                        data: [
                            [1, 'Caroline', 'Jensen', 'carolinejensen@zidant.com', '+1 (821) 447-3782'],
                            [2, 'Celeste', 'Grant', 'celestegrant@polarax.com', '+1 (838) 515-3408'],
                            [3, 'Tillman', 'Forbes', 'tillmanforbes@manglo.com', '+1 (969) 496-2892'],
                            [4, 'Daisy', 'Whitley', 'daisywhitley@applideck.com', '+1 (861) 564-2877'],
                            [5, 'Weber', 'Bowman', 'weberbowman@volax.com', '+1 (962) 466-3483'],
                            [6, 'Buckley', 'Townsend', 'buckleytownsend@orbaxter.com', '+1 (884) 595-2643'],
                            [7, 'Latoya', 'Bradshaw', 'latoyabradshaw@opportech.com', '+1 (906) 474-3155'],
                            [8, 'Kate', 'Lindsay', 'katelindsay@gorganic.com', '+1 (930) 546-2952'],
                            [9, 'Marva', 'Sandoval', 'marvasandoval@avit.com', '+1 (927) 566-3600'],
                            [10, 'Decker', 'Russell', 'deckerrussell@quilch.com', '+1 (846) 535-3283'],
                            [11, 'Odom', 'Mills', 'odommills@memora.com', '+1 (995) 525-3402'],
                            [12, 'Sellers', 'Walters', 'sellerswalters@zorromop.com', '+1 (830) 430-3157'],
                            [13, 'Wendi', 'Powers', 'wendipowers@orboid.com', '+1 (863) 457-2088'],
                            [14, 'Sophie', 'Horn', 'sophiehorn@snorus.com', '+1 (885) 418-3948'],
                            [15, 'Levine', 'Rodriquez', 'levinerodriquez@xth.com', '+1 (999) 565-3239']
                        ]
                    },
                    sortable: true,
                    searchable: true,
                    perPage: 10,
                    perPageSelect: [10, 20, 30, 50, 100],
                    firstLast: true,
                    firstText: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M13 19L7 12L13 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> <path opacity="0.5" d="M16.9998 19L10.9998 12L16.9998 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',
                    lastText: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M11 19L17 12L11 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> <path opacity="0.5" d="M6.99976 19L12.9998 12L6.99976 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',
                    prevText: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M15 5L9 12L15 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',
                    nextText: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5 rtl:rotate-180"> <path d="M9 5L15 12L9 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/> </svg>',
                    labels: {
                        perPage: "{select}",
                        noRows: "No entries found",
                        info: "Showing {start} to {end} of {rows} entries",
                        noResults: "No results match your search query"
                    },
                    layout: {
                        top: "{search}",
                        bottom: "{info}{select}{pager}",
                    },
                };

                const datatableHover = new simpleDatatables.DataTable('#tableHover', tableOptions);
            }
        }));
    });

    </script>
{% endblock %}